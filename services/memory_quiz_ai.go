package services

import (
	"couple-app/models" // üëà 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô your_project_name ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢)
	"encoding/json"
	"fmt"
)

// ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å *QuizQuestion ‡πÄ‡∏õ‡πá‡∏ô *models.QuizQuestion
func GenerateQuizFromMemory(memoryContent string) (*models.QuizQuestion, error) {
	prompt := fmt.Sprintf(`
    [SYSTEM ROLE] ‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠ "‡∏Å‡∏≤‡∏°‡πÄ‡∏ó‡∏û‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥" ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏¥‡∏ã‡∏´‡∏ß‡∏≤‡∏ô‡πÜ
    [INPUT] ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥: "%s"

    [GOAL] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Å‡∏é‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
    1. ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ô‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ß‡∏≤‡∏ô
    2. ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏ï‡∏•‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡πÜ ‡πÅ‡∏ï‡πà‡∏´‡πâ‡∏≤‡∏°‡∏Å‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó‡∏à‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®
    3. ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON FORMAT ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô:
       {
         "question": "‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...",
         "options": ["‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1", "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2", "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 3", "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 4"],
         "answer_index": 0,
         "sweet_comment": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡πÜ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å"
       }
    4. ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å JSON`, memoryContent)

	// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ AskGroqCustom ‡∏ó‡∏µ‡πà‡∏ô‡∏≤‡∏¢‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
	rawResponse := AskGroqCustom(prompt, 1000)

	// üëà 2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô models.QuizQuestion
	var quiz models.QuizQuestion
	err := json.Unmarshal([]byte(rawResponse), &quiz)
	if err != nil {
		return nil, fmt.Errorf("failed to parse quiz: %v", err)
	}

	return &quiz, nil
}
